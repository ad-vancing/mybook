
# 普通 Hash 原理
它是一种摘要算法，即根据原有的内容产生一个简短的摘要结果。
摘要结果跟原内容是相关的，原内容的改变（极大概率）会导致摘要内容的改变。

Hash算法的使用非常广泛，例如：对一段信息生成Hash值后，可以作为校验信息是否发生变更的依据；通过Hash算法，将请求均匀地分配到应用服务器上；使用Hash算法，确保同样的用户总是访问同一个服务器等。

## 说说你知道的几种HASH算法
MD5、SHA-1、SHA-2

# 一致性 Hash 原理 
随着用户增多，我们增加一台服务器时，此时一般需要进行重新Hash操作，对各个服务器上的数据进行重新分配，此操作几乎涉及所有服务器上的所有数据，工作量极大。

在分布式系统中，扩容缩容操作极为常见，如果频繁进行重Hash操作显然是不可取的，一是消耗太大，而是可能引发服务的中断。此时，就要采用一致性Hash算法。

一致性Hash算法（Consistent Hashing）是一种hash算法，它**能够在Hash输出空间发生变化时，引起最小的变动**。

好的一致性Hash算法应该能够满足以下要求：


平衡性：这是Hash算法的基本要求，是指哈希的结果均匀地分配在整个输出空间中。   
单调性：当发生数据节点变动时，对于相同的数据始终映射到相同的缓冲节点中或者新增加的缓冲节点中，避免无法找到原来的数据。  
稳定性：当出现节点坏掉或热点访问而需要动态扩容时，尽量减少数据的移动。显然一般的Hash方法不满足这一点。


一致性哈希算法最早在论文《Consistent Hashing and Random Trees: Distributed Caching Protocols for Relieving Hot Spots on the World Wide Web》中提出。具体思路就是一致性哈希将整个哈希输出空间设置为一个环形区域。

对节点和数据，都做一次哈希运算，然后比较节点和数据的哈希值，数据存放在下一个的节点中，这样就会保证节点增加或者减少的时候，影响的数据最少。

通过将整个哈希输出空间设置为一个环形区域，减小了输出空间的变化对哈希结果的影响。


# 一致性 Hash 的缺点
服务节点过少的情况下，是不是会导致节点分配不均匀可能会导致数据倾斜的问题。
![](https://ask.qcloudimg.com/http-save/1692602/r0667ghnr0.jpeg?imageView2/2/w/1620)
为了解决数据倾斜的问题，一致性哈希算法引入了虚拟节点机制：即对每一个服务节点计算多个哈希，每个计算得到的Hash位置都放置一个此服务节点，称虚拟节点。具体可以在服务器ip或主机名的后面增加编号来实现。
