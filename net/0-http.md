# 输入一个网址，在浏览器中会发生什么 《图解HTTP》
1. 浏览器数据封包
2. 浏览器查找域名的IP地址（数据链路层解析 IP 与 mac 地址的映射）
从dns服务器拿CDN的IP,再去cdn逐级访问  
DNS查找过程如下：
浏览器缓存 – 浏览器会缓存DNS记录一段时间。 有趣的是，操作系统没有告诉浏览器储存DNS记录的时间，这样不同浏览器会储存个自固定的一个时间（2分钟到30分钟不等）。
系统缓存 – 如果在浏览器缓存里没有找到需要的记录，浏览器会做一个系统调用（windows里是gethostbyname）。这样便可获得系统缓存中的记录。
路由器缓存 – 接着，前面的查询请求发向路由器，它一般会有自己的DNS缓存。
ISP DNS 缓存 – 接下来要check的就是ISP缓存DNS的服务器。在这一般都能找到相应的缓存记录。
递归搜索 – 你的ISP的DNS服务器从跟域名服务器开始进行递归搜索，从.com顶级域名服务器到Facebook的域名服务器。一般DNS服务器的缓存中会有.com域名服务器中的域名，所以到顶级服务器的匹配过程不是那么必要了。

3. 浏览器给web服务器发送一个HTTP请求 (网络层面～～)
数据交换主要通过 http 协议， http 协议是无状态协议，这里可以谈一谈 post、get 的区别以及 RESTFul 接口设计；
如果走 https 还需要会话层 TLS、SSL 等协议； 
client （浏览器）与 server 通过 http 协议通讯，http 协议属于应用层协议，http 基于 tcp 协议，tcp 属于传输层协议。
传输层 tcp 协议可以说下比较经典的三次握手、四次分手的过程和状态机

4. server 处理流程
server 这边 Nginx 拿到请求，进行一些验证，比如黑名单拦截之类的，
然后 Nginx 直接处理静态资源请求，其他请求 Nginx 转发给后端服务器，
tomcat

   (这里我用 uWSGI, 他们之间通过 uwsgi 协议通讯，uWSGI 拿到请求，可以进行一些逻辑， 验证黑名单、判断爬虫等，根据 wsgi 标准，把拿到的 environs 参数扔给 Django ，Django 根据 wsgi 标准接收请求和 env， 然后开始 start_response ，先跑 Django 相关后台逻辑，Django 拿到请求执行 request middleware 内的相关逻辑，然后路由到相应 view 执行逻辑，出错执行 exception middleware 相关逻辑，接着 response 前执行 response middleware 逻辑，最后通过 wsgi 标准构造 response， 拿到需要返回的东西，设置一些 headers，或者 cookies 之类的，最后 finish_response 返回，再通过 uWSGI 给 Nginx ，Nginx 返回给浏览器。)

5. 浏览器响应渲染

更好的：https://juejin.cn/post/6844903744644055054


![](https://segmentfault.com/img/remote/1460000008758387?w=875&h=976)
https://segmentfault.com/a/1190000008758381

## 精简版
在浏览器地址栏键入URL，按下回车之后会经历以下流程：

1. 浏览器向DNS 服务器请求解析该 URL 中的域名所对应的 IP 地址;
2. 解析出 IP 地址后，根据该 IP 地址和默认端口 80，和服务器建立 TCP 连接;
3. 浏览器发出读取文件(URL 中域名后面部分对应的文件)的HTTP 请求，该请求报文作为 TCP 三次握手的第三个报文的数据发送给服务器;
4. 服务器对浏览器请求作出响应，并把对应的 html 文本发送给浏览器;
5. 释放 TCP 连接;
6. 浏览器将该 html 文本并显示内容;

## 更好版
1. DNS 解析：浏览器查询 DNS，获取域名对应的 IP 地址。  
2. TCP 连接：浏览器获得域名对应的 IP 地址以后，浏览器向服务器请求建立链接，发起三次握手；
3. 发送 HTTP 请求：TCP 连接建立起来后，浏览器向服务器发送 HTTP 请求；
4. 服务器处理请求并返回 HTTP 报文：服务器接收到这个请求，并根据路径参数映射到特定的请求处理器进行处理，并将处理结果及相应的视图返回给浏览器；
5. 浏览器解析渲染页面：浏览器解析并渲染视图，若遇到对 js 文件、css 文件及图片等静态资源的引用，则重复上述步骤并向服务器请求这些资源；浏览器根据其请求到的资源、数据渲染页面，最终向用户呈现一个完整的页面。
6. 连接结束。

### DNS 的解析过程
主机向本地域名服务器的查询一般都是采用递归查询。  


本地域名服务器向根域名服务器的查询的迭代查询。

### 域名缓存
为了提高 DNS 查询效率，并减轻服务器的负荷和减少因特网上的 DNS 查询报文数量，在域名服务器中广泛使用了高速缓存，用来存放最近查询过的域名以及从何处获得域名映射信息的记录。


# HTTPS 是怎么加密的
[HTTPS 之 SSL/TLS 握手协议（Handshake Protocol）全过程解析](https://www.jianshu.com/p/07a1e362e1ba)

非对称加密耗时，对称加密不够安全，结合。
非对称加密算法用于在握手过程中加密生成的密码，对称加密算法用于对真正传输的数据进行加密，而HASH算法用于验证数据的完整性。
公钥只能用于加密数据，因此可以随意传输，而网站的私钥用于对数据进行解密，所以网站都会非常小心的保管自己的私钥，防止泄漏。

HTTPS协议是由SSL+HTTP协议构建的可进行加密传输、身份认证的网络协议。
https://zhuanlan.zhihu.com/p/43789231

HTTPS在传输数据之前需要客户端（浏览器）与服务端（网站）之间进行一次握手，在握手过程中将确立双方加密传输数据的密码信息。
1. 浏览器将自己支持的一套加密规则发送给网站。
2. 网站从中选出一组加密算法与HASH算法，并将自己的身份信息以证书的形式发回给浏览器。**证书里面包含了网站地址，加密公钥***，以及证书的颁发机构等信息。
3. 获得网站证书之后浏览器要做以下工作：
a) 验证证书的合法性（颁发证书的机构是否合法，证书中包含的网站地址是否与正在访问的地址一致等），如果证书受信任，则浏览器栏里面会显示一个小锁头，否则会给出证书不受信的提示。
b) 如果证书受信任，或者是用户接受了不受信的证书，浏览器会生成一串随机数的密码，并用证书中提供的公钥加密。
c) 使用约定好的HASH计算握手消息，并使用生成的随机数对消息进行加密，最后将之前生成的所有信息发送给网站。

4. 网站接收浏览器发来的数据之后要做以下的操作：
a) 使用自己的私钥将信息解密取出密码，使用密码解密浏览器发来的握手消息，并验证HASH是否与浏览器发来的一致。
b) 使用密码加密一段握手消息，发送给浏览器。
5. 浏览器解密并计算握手消息的HASH，如果与服务端发来的HASH一致，此时握手过程结束，之后所有的通信数据将由之前浏览器生成的随机密码并利用对称加密算法进行加密。

这里浏览器与网站互相发送加密的握手消息并验证，目的是为了保证双方都获得了一致的密码，并且可以正常的加密解密数据，为后续真正数据的传输做一次测试。

##  HTTPS 和 HTTP 的区别
Http协议运行在TCP之上，明文传输，客户端与服务器端都无法验证对方的身份；  
Https是身披SSL(Secure Socket Layer)外壳的Http运行于SSL上，SSL运行于TCP之上，是添加了加密和认证机制的HTTP。  

二者之间存在如下不同：
- 安全性：HTTP 的连接很简单，是无状态的；HTTPS 协议是由 TLS+HTTP 协议构建的可进行加密传输、身份认证的网络协议，比 HTTP 协议安全
- 端口不同：Http与Https使用不同的连接方式，用的端口也不一样，前者是80，后者是443；
- 资源消耗：和HTTP通信相比，Https通信会由于加减密处理消耗更多的CPU和内存资源；
- 开销：Https通信需要证书，而证书一般需要向认证机构购买；  
  
HTTP只需要创建一次TCP连接，而HTTPS需要创建两次TCP连接

# HTTP1.0，1.1，2.0 
- HTTP/1.0  

浏览器与服务器只保持短暂的连接，连接无法复用。也就是说每个TCP连接只能发送一个请求。发送数据完毕，连接就关闭，如果还要请求其他资源，就必须再新建一个连接。

我们知道TCP连接的建立需要三次握手，是很耗费时间的一个过程。所以，HTTP/1.0版本的性能比较差。

好像我们打电话的时候，只能说一件事儿一样，说完之后就要挂断，想要说另外一件事儿的时候就要重新拨打电话。

- HTTP/1.0 

引入了**持久连接**。所谓的持久连接即TCP连接默认不关闭，可以被多个请求复用。

还引入了**管道机制（pipelining）**，即在同一个TCP连接里面，客户端可以同时发送多个请求。这样就进一步改进了HTTP协议的效率。

- HTTP/2.0

采用了多路复用。即在一个连接里，客户端和浏览器都可以同时发送多个请求或回应，而且不用按照顺序一一对应。能这样做有一个前提，就是HTTP/2进行了**二进制分帧**，即 HTTP/2 会将所有传输的信息分割为更小的消息和帧（frame）,并对它们采用二进制格式的编码。  

其他的优化，比如做Header压缩、服务端推送等。

Header压缩就是压缩老板和员工之间的对话。

服务端推送就是员工事先把一些老板可能询问的事情提现发送到老板的手机（缓存）上。这样老板想要知道的时候就可以直接读取短信（缓存）了。
 
## HTTP1.1和2.0协议的区别
http2中 每个消息被划分为更小的帧单元。
与 http1.1把所有请求和响应作为纯文本不同，http2 使用二进制框架层把所有消息封装成二进制，且仍然保持http语法，消息的转换让http2能够尝试http1.1所不能的传输方式。
https://www.jianshu.com/p/63fe1bf5d445

[https://blog.csdn.net/ThinkWon/article/details/104397516](https://blog.csdn.net/ThinkWon/article/details/104397516)
一样的http://ifeve.com/spring-interview-questions-and-answers/
一样的https://zhuanlan.zhihu.com/p/115029344

[https://www.zhihu.com/question/39814046](https://www.zhihu.com/question/39814046)

[https://juejin.im/post/6844903860658503693](https://juejin.im/post/6844903860658503693)[https://juejin.im/post/6854573217013727246](https://juejin.im/post/6854573217013727246)[https://www.cnblogs.com/jingmoxukong/p/9408037.html](https://www.cnblogs.com/jingmoxukong/p/9408037.html)

[aop](https://my.oschina.net/spinachgit/blog/3013159)[Spring容器IOC初始化过程](https://www.javazhiyin.com/64744.html)

# GET请求中URL编码的意义
解决参数值中包含 = 或 & 这种特殊字符的时候，对参数进行URL编码后，服务端会把紧跟在“%”后的字节当成普通的字节，就是不会把它当成各个参数或键值对的分隔符了。

# osi 7层，每一层的协议
- 物理层，负责在物理⽹络中传输数据帧；  
- 数据链路层，负责数据的封帧和差错检测，以及 MAC 寻址；  
- ⽹络层，定义IP编址，定义路由功能，负责数据的路由、转发、分⽚，协议有： IP（IPV4 IPV6） ARP RARP ICMP；  
- 传输层，负责端到端的数据包传输，协议有：TCP UDP，数据包一旦离开网卡即进入网络传输层； 
- 会话层，负责建⽴、管理和终⽌表示层实体之间的通信会话和验证，如登入、断点续传； 
- 表示层，负责把数据转换成兼容另⼀个系统能识别的格式，数据加解密，图片编码解码；
- 应⽤层，负责给应⽤程序提供统⼀的接⼝，协议有：HTTP FTP TFTP SMTP SNMP DNS TELNET HTTPS POP3 DHCP。  
[参考](https://www.jianshu.com/p/9b9438dff7a2)  
[其他参考](https://www.cnblogs.com/cashew/p/10722116.html)  

网络七层模型是一个标准，而非实现。  

# 网络五层模型
网络5层模型是由七层模型简化合并而来的一个实现的应用模型。

https://www.iamshuaidi.com/723.html

# IP地址的分类
IP地址根据网络号 的不同分为 5 种类型：A 类地址、B 类地址、C 类地址、D 类地址和 E 类地址。  
[其他参考](https://www.cnblogs.com/cashew/p/10722116.html) 

https://www.iamshuaidi.com/704.html


# ARP 协议的工作原理
IP 地址主要用来网络寻址用的，就是大致定位你在哪里，而 MAC 地址，则是身份的唯一象征，通过 MAC 来唯一确认这人是不是就是你，MAC 地址不具备寻址的功能。

网络层的 ARP 协议完成了 IP 地址与物理地址的映射。  

每台主机都会在自己的 ARP 缓冲区中建立一个 ARP 列表，以表示 IP 地址和 MAC 地址的对应关系。


# ping的原理
[参考](https://www.jianshu.com/p/14113212cd18)

用“ping”命令可以检查网络是否通畅或者网络连接速度，很好地分析和判定网络故障。   
利用网络上机器IP地址的唯一性，给目标IP地址发送一个数据包，通过对方回复的数据包来确定两台网络机器是否连接相通，时延是多少。   

PING命令是我们能够直接使用的命令，像HTTP、FTP，属于应用层。ping命令底层使用的是ICMP协议，ICMP报文封装在ip包里，所以ICMP属于**网络层**协议，它没有通过运输层的TCP或UDP。

Ping发送一个ICMP；接收端回应消息给目的地并报告是否收到所希望的ICMPecho （ICMP回声应答）。

##  ICMP 协议
Internet Control Message Protocol 互联网控制报文协议  
主要的功能包括：确认 IP 包是否成功送达目标地址、报告发送过程中 IP 包被废弃的原因和改善网络设置等。
